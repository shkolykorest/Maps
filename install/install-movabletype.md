# Установка Movable Type

Если вы хотите установить Movable Type на виртуальный хостинг, ознакомьтесь со [[списком рекомендуемых хостеров|hosting]].

## Системные требования

Чтобы начать работать с Movable Type, не нужно иметь свой собственный сервер, достаточно взять в аренду хостинг. Тем не менее, если у вас есть собственный сервер или VPS (виртуальный выделенный сервер), то следующая информация поможет определить, удовлетворяет ли он требованиям для работы с Movable Type.

* См. статью [[Системные требования|system-requirements]]

## Какие программы потребуются для установки

Для загрузки файлов на сервер потребуется FTP или SSH клиент. В качестве FTP-клиента можно порекомендовать бесплатную программу [Filezilla](http://filezilla-project.org/). А для работы с SSH — бесплатную программу [Putty](http://putty.org.ru/) (расширенная версия — [ExtraPuTTY](http://www.extraputty.com/)\) или платную [SecureCRT](http://www.vandyke.com/products/securecrt/). В Linux и MacOS для доступа по SSH к серверу можно использовать обычный терминал.

### Необходимая для установки информация

* Имя пользователя и пароль для доступа на сервер (по FTP или SSH);
* Путь до директории, где разрешено выполнение CGI-скриптов (обычно это папка cgi` или `cgi-bin`);
* Путь до директории, где будет располагаться сайт;
* Путь до директории, где будут находиться статические файлы Movable Type;
* Хост базы банных, а также имя пользователя и пароль.

Примечание: базу данных необходимо создать до установки MT. 

## Быстрая установка Movable Type

Чтобы быстро установить Movable Type, следуйте следующим инструкциям:

* Загрузите на сервер все файлы Movable Type, кроме папки `mt-static`. Файлы должны быть загружены в папку `cgi-bin` (или `cgi`), в которой разрешено выполнение CGI скриптов. Например, вот как может выглядеть стандартная установка: `http://example.com/cgi-bin/mt/`.
* Папку `mt-static` необходимо загрузить в корневую директорию вашего сайта, чтобы доступ к ней был следующего вида: `http://example.com/mt-static/`.
* На все `.cgi` файлы (например, `mt.cgi`, `mt-search.cgi`, и т.д.), находящиеся в директории Movable Type, необходимо выставить права доступа (CHMOD) 755.
* Откройте Movable Type в браузере. Например, адрес может выглядеть так: `http://example.com/cgi-bin/mt/mt.cgi`. 
* Автоматически запустится инсталлятор. Следуйте инструкциям установки.

## Детальное описание установки Movable Type

В этом разделе детально рассмотрена установка Movable Type на Linix-сервер, а также несколько дополнительных действий, чтобы в будущем избежать возможных проблем.

### Работа с дистрибутом

Последнюю стабильную русскую версию всегда можно скачать по адресу:

* [movable-type.ru/mt4](http://movable-type.ru/mt4) (или в [tar.gz-архиве](http://movable-type.ru/mt4tar)\) — Movable Type 4
* [movable-type.ru/mt5](http://movable-type.ru/mt5) (или в [tar.gz-архиве](http://movable-type.ru/mt5tar)\) — Movable Type 5

Остальные версии, включая архивные, можно скачать с сайта MT.ru: http://movable-type.ru/downloads/.

Если вам необходима Pro-версия, то её можно скачать по следующему адресу: www.movabletype.com/download/

### Отличия версий

* См. статью [[Версии Movable Type|versions]]

### Получение необходимой информации

#### Папка для скриптов

Платформа Movable Type написана на языке Perl, поэтому для успешной работы необходимо узнать, в какой папке на сервере возможно выполнение CGI-скриптов. Обычно эта папка называется `cgi` или `cgi-bin`, и может быть доступна по адресу `http://example.com/cgi/` или `http://example.com/cgi-bin/` одновременно. Папка `cgi` обычно располагается на том же уровне, где и корневая папка документов домена.

<img src="./assets/cgi-dir.png" alt="Расположение папки с CGI-скриптами"/>

Если вы сомневаетесь, где находится папка для выполнения CGI-скриптов, то необходимо уточнить эту информацию у службы поддержки хостера или у администратора сервера.

#### Папка со статическими файлами

В дистрибутиве Movable Type есть специальная папка, в которой содержатся все статические файлы — `mt-static`. По умолчанию она находится в той же папке, где и все остальные файлы. Но её необходимо разместить в корневой директории вашего сайта. Вот как это может выглядеть:

<img src="./assets/mt-staic-dir.png" alt="Расположение папки mt-static" />

#### Адрес и путь расположения блога

Блог может располагаться как в корневой директории, так и в любой поддиректории, и даже на отдельном домене. Рассмотрим вариант с установкой блога в корневую директорию домена.

Корневая директория домена — это, обычно, папка `docs`, `htdocs` или `public_html`. В этой папке хранятся документы, которые будут доступны по адресу `http://example.com/`.

* Относительный URL: `/example-folder/`
* Абсолютный URL : `http://example.com/example-folder/`
* Относительный путь на сервере: `./example-folder` или `../example-folder`, или `example-folder`
* Абсолютный путь на сервере: `/home/username/example.com/docs/example-folder`

Обратите внимание, что относительный путь на сервере не может начинаться со слэша (знак косой черты — «/»), иначе путь будет рассчитываться от корневой директории сервера.

#### База данных

Для работы Movable Type 4 подойдёт одна из следующих баз данных: MySQL, PostgreSQL или SQLite. Рекомендуется использовать MySQL или PostgreSQL, так как именно с этими базами данных Movable Type работает наиболее быстро.

При установке необходимо будет указать имя пользователя, название базы данных, а также хост, на котором она работает. Всю эту информацию предоставляет хостер или администратор сервера при создании базы данных.

#### FTP и SSH

[FTP](http://ru.wikipedia.org/wiki/FTP) — это простой способ переслать файлы на другой сервер; это специальный протокол, который поддерживается практически всеми серверами.

[SSH](http://ru.wikipedia.org/wiki/SSH) — это продвинутый, защищённый протокол, с помощью которого можно удалённо управлять сервером, отправляя ему необходимые команды.

Для работы того или другого понадобятся следующие данные: имя пользователя, пароль, хост для подключения.
Для работы с SSH вам понядобятся знать некоторые команды. Самые распространённые из них приведены в статье [[Полезные команды Linux|useful-linux-commands]].

### Закачка дистрибутива на сервер

После того, как вы скачали архив с дистрибутивом, его необходимо распаковать и закачать на свой сервер. Рекомендуется создать в папке `cgi` подпапку `mt` и закачивать файлы в неё. 

<img src="./assets/mt-files.png" alt="Файлы Movable Type" />

Примечание: Не забудьте переместить папку `mt-static` в корневую директорию домена.

Примечание: при закачке файлов по FTP, теряются права доступа на них. Поэтому нужно вручную установить права доступа (CHMOD) на все файлы с расширение `.cgi`, равные 755.

<img src="./assets/mt-files-chmod.png" alt="Установка прав доступа" />

Если вы используете SSH, то гораздо проще и быстрее будет закачать на сервер архив, и уже там распаковать его. Для этого используйте следующие команды:

```bash
cd /home/username/example.com/cgi
```
_(переход в папку cgi)_

```bash
wget http://movable-type.ru/mt-latest-tar
```
_(скачивание архива tar.gz с последней русской версией Movable Type)_

```bash
tar xzf MT*.tar.gz
```
_(распаковка архива)_

После этих действий  в папке `cgi` у вас будет архив `MT-4.32-ru.tar.gz` (версия может отличаться), а также папка `MT-4.32-ru`. Теперь необходимо переименовать папку `MT-4.32-ru` в папку mt. Для этого нужна специальная команда:
```bash
mv MT-4.32-ru mt
```

Основная папка Movable Type переименована, но в ней по-прежнему находится папка со статическими файлами, её необходимо переместить:
```bash
cd mt
```
_(переход в папку mt)_

```bash
mv mt-static /home/username/example.com/docs/mt-static
```
_(перемещение папки mt-static в корневую директорию домена)_

### Подготовка базы данных

Movable Type использует кодировку UTF-8. Это наиболее современная кодировка, которую поддерживает большинство серверов. На российских серверах, чаще всего, установлена кодировка cp1251 (windows-1251) — кириллица. А на зарубежных — latin1. Поэтому необходимо настроить базу данных на корректную работу с кодировкой UTF-8.

Пример настройки базы данных MySQL через PHPMyAdmin:

<img src="./assets/mysql-encoding.png" alt="Настройка кодировки базы данных" />

### Установка Movable Type

Для установки откройте в браузере адрес, на котором располагается MT. Например, это может быть адрес `http://example.com/cgi-bin/mt/mt.cgi`. Если всё нормально, то запустится инсталлятор, с помощью которого нужно будет указать необходимые для установки данные.

## Возможные проблемы при установке или после неё

### 500-я ошибка сервера

Возникает, чаще всего, из-за того, что неправильно установлены права доступа на CGI-скрипты. В Linux- системах, чтобы подобные скрипты были «выполняемыми», на них необходимо установить права доступа 755 (по-другому права доступа называются CHMOD, от англ. change mode). 

### После установки на сайте кириллица отображается какими-то непонятными символами

Это значит, что на сервере по умолчанию выставлена неправильная кодировка. Чаще всего, это `cp1251` (`windows-1251`). Необходимо изменить кодировку по умолчанию на UTF-8. Для этого, если у вас веб-сервер Apache, добавьте в корневой каталог вашего сайта файл `.htaccess` (с точкой в начале):

```apache
AddDefaultCharset utf-8
```

Если подобная проблема возникает при работе с Movable Type, то попробуйте добавить в файл [[mt-config.cgi|mt-config]] следующую строчку:

```
SQLSetNames 1
```
