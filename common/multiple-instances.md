# Управление несколькими инсталляциями Movable Type

В некоторых случаях может возникнуть желание или необходимость организовать несколько инсталляций Movable Type с разными конфигурационными файлами. Это позволит:

* Упростить техническое обслуживание всех инсталляций Movable Type;
* Ускорит модернизацию системы, так как потребуется обновление файлов только в одном месте;
* Упростит управление плагинами, так как плагины располагаются в одном месте.

Для этого необходимо для каждой инсталляции Movable Type создать свой собственный [[mt-config.cgi|mt-config]] файл, в котором будут определены специфические свойства конфигурации для каждого экземпляра MT, в том числе информацию о соединении с базой данных.

## Как это работает

Movable Type смотрит сначала на конкретные переменные среды и получает инструкции, где искать основной исходный код и файл конфигурации. Эти переменные окружения:

* `MT_HOME` — эта переменная должна указывать на каталог, который содержит mt.cgi файл и используется для построения пути поиска до `lib` и `extlib` каталогов, которые содержат основной исходный код Movable Type. Если это переменная не определена, то Movable Type будет использовать текущую директорию в качестве значения MT_HOME.
* `MT_CONFIG` — эта переменная содержит полный путь к файла конфигурации Movable Type. Если он не определен, то Movable Type будет использовать `$MT_HOME/mt-config.cgi` как путь к  конфигурационному файлу MT.


**Важное примечание:** Movable Type требует, чтобы все mt-config.cgi файлы, которые используются для различных инсталляций MT, должны быть расположены в одном каталоге. Это связано с тем, что Movable Type выводит определенные пути в файловой системе, основанные на месте расположения mt-config.cgi.

## Настройки Apache

Один экземпляр Apache может быть использован для размещения сайтов под неограниченным количеством доменов. Это достигается за счет использования виртуальных хостов Apache (VirtualHosts). Каждый виртуальный хост может иметь свои собственные независимые конфигурации и переменные окружающей среды для обработки веб-запросов и позволяет системным администраторам контролировать каждый домен отдельно.

## Пример конфигурации

В следующем примере используются следующие допущения:

* Movable Type установлен в `/var/www/shared/cgi-bin/mt`
* Необходимо настроить два сайта `site1.somedomain.com` и `site2.somedomain.com`, используя один MT, но разные базы данных.
* Эти два веб-сайта имеют свои Movable Type файлы конфигурации. Эти файлы находятся в `/var/www/shared/conf/`.

В этом примере используется модуль Apache `mod_env` указывающий на один экземпляр Movable Type, но различные файлы конфигурации для каждого экземпляра сайта.

```apache
<VirtualHost *:80>
    ServerName site1.somedomain.com
    SetEnv MT_HOME /var/www/shared/cgi-bin/mt
    SetEnv MT_CONFIG /var/www/shared/conf/site1-mt-config.cgi
    ScriptAlias /cgi-bin/ /var/www/shared/cgi-bin/
    Alias /mt-static/ /var/www/shared/cgi-bin/mt-static/
</VirtualHost>

<VirtualHost *:80>
    ServerName site2.somedomain.com
    SetEnv MT_HOME /var/www/shared/cgi-bin/mt
    SetEnv MT_CONFIG /var/www/shared/conf/site2-mt-config.cgi
    ScriptAlias /cgi-bin/ /var/www/shared/cgi-bin/
    Alias /mt-static/ /var/www/shared/cgi-bin/mt/mt-static/
</VirtualHost>
```

В приведенном выше примере, доступ до Movable Type можно получить используя следующие URL:

* http://site1.somedomain.com/cgi-bin/mt/mt.cgi
* http://site2.somedomain.com/cgi-bin/mt/mt.cgi

